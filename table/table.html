<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div id="table"></div>
        <div id="states"></div>
        
        <script>
            let alert_selected = 0
            const x = document.getElementById("table")
            x.innerHTML = "Caricamento ..."

            //let states = document.getElementById("states") -> mettere una checkbox
            let states = "ALL"
            let order = "time"
            let xhttp = new XMLHttpRequest()

            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.response)

                    res = JSON.parse(this.response)
                    
                    table = makeTable(res)
                    
                    x.innerHTML = table
                }
            }

            xhttp.open("GET", "table.php?states=" + states, true)
            xhttp.setRequestHeader("Cache-Control", "no-cache")
            xhttp.send()

            function makeTable(res){
                if(res.alerts.length > 0){
                    table = "<table>"
                    res.alerts.forEach(function(row) {
                        table += "<tr id=" + row['id_alert'] + " class=" + row['state'] + " onclick='selectAlert(\"" + row['id_alert'] + "\")'> <td>FOTO</td> <td>VIA</td> <td>" + 
                        row['id_type'] + "</td> <td>" + (row['description'] ? row['description'] : "EMPTY LINE") + "</td> </tr>"
                    })
                    table += "</table>"
                    return table
                }else{
                    return "DATABASE IS EMPTY"
                }
            }

            function selectAlert(id_alert){
                if(alert_selected == id_alert){
                    deselectRow(id_alert)
                    alert_selected = 0
                }else{
                    selectRow(id_alert)
                    if(alert_selected != 0) selectAlert(alert_selected)
                    alert_selected = id_alert
                }
            }

            function selectRow(id_alert){
                switch(document.getElementById(id_alert).getAttribute("class")){
                    case "NEW":
                        document.getElementById(id_alert).setAttribute("class","NEW_SELECT")
                        break
                    case "SEEN":
                        document.getElementById(id_alert).setAttribute("class","SEEN_SELECT")
                        break
                    case "SOLVED":
                        document.getElementById(id_alert).setAttribute("class","SOLVED_SELECT")
                        break
                }
            }

            function deselectRow(id_alert){
                switch(document.getElementById(id_alert).getAttribute("class")){
                    case "NEW_SELECT":
                        document.getElementById(id_alert).setAttribute("class","NEW")
                        break
                    case "SEEN_SELECT":
                        document.getElementById(id_alert).setAttribute("class","SEEN")
                        break
                    case "SOLVED_SELECT":
                        document.getElementById(id_alert).setAttribute("class","SOLVED")
                        break
                }
            }

        </script>

    </body>
</html>